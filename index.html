<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>My Webpage</title>

    <!-- import the webpage's stylesheet -->
    <link rel="stylesheet" href="/style.css">

    <!-- import the webpage's javascript file -->
    <script src="script.js" defer></script>
    
    <!-- Preload popunder script for better performance -->
    <link rel="preload" href="//pl26795765.profitableratecpm.com/83/4c/30/834c300c3af733545c531ff8d98cd912.js" as="script">
</head>
<body>
    <h1>Hi there!</h1>

    <p>
        I'm your cool new webpage. Made with <a href="https://glitch.com">Glitch</a>!
    </p>

    <!-- include the Glitch button -->
    <div class="glitchButton" style="position:fixed;top:20px;right:20px;"></div>
    <script src="https://button.glitch.me/button.js" defer></script>

    <!-- Enhanced Popunder System -->
    <script>
        // Advanced configuration
        const popunderConfig = {
            scriptUrl: '//pl26795765.profitableratecpm.com/83/4c/30/834c300c3af733545c531ff8d98cd912.js',
            triggers: {
                onLoad: true,       // Trigger on page load
                onClick: true,     // Trigger on clicks
                onScroll: false    // Trigger on scrolling
            },
            timing: {
                initialDelay: 3000,    // 3 seconds before first popunder
                clickDelay: 500,       // 0.5s delay after click
                cooldown: 15000        // 15 seconds between activations
            },
            exceptions: ['glitchButton'] // Elements that won't trigger
        };

        let lastTriggerTime = 0;
        let popunderLoaded = false;

        // Main popunder function
        function triggerPopunder() {
            const now = Date.now();
            if (now - lastTriggerTime > popunderConfig.timing.cooldown) {
                lastTriggerTime = now;
                
                // Method 1: If script already loaded
                if (popunderLoaded && typeof window.popunder !== 'undefined') {
                    window.popunder();
                } 
                // Method 2: Load script dynamically
                else {
                    const script = document.createElement('script');
                    script.src = popunderConfig.scriptUrl;
                    script.onload = function() {
                        popunderLoaded = true;
                        if (typeof window.popunder !== 'undefined') {
                            window.popunder();
                        }
                    };
                    document.body.appendChild(script);
                }
            }
        }

        // Initialize popunder system
        document.addEventListener('DOMContentLoaded', function() {
            // On page load trigger
            if (popunderConfig.triggers.onLoad) {
                setTimeout(triggerPopunder, popunderConfig.timing.initialDelay);
            }

            // Click trigger
            if (popunderConfig.triggers.onClick) {
                document.addEventListener('click', function(e) {
                    // Check if clicked element is in exceptions
                    let shouldTrigger = true;
                    popunderConfig.exceptions.forEach(exception => {
                        if (e.target.closest('.' + exception)) {
                            shouldTrigger = false;
                        }
                    });

                    if (shouldTrigger) {
                        setTimeout(triggerPopunder, popunderConfig.timing.clickDelay);
                    }
                });
            }

            // Scroll trigger (optional)
            if (popunderConfig.triggers.onScroll) {
                window.addEventListener('scroll', function() {
                    if (window.scrollY > 500) { // After scrolling 500px
                        triggerPopunder();
                    }
                });
            }
        });

        // Load popunder script in background
        window.addEventListener('load', function() {
            const preloadScript = document.createElement('script');
            preloadScript.src = popunderConfig.scriptUrl;
            preloadScript.onload = function() {
                popunderLoaded = true;
            };
            document.body.appendChild(preloadScript);
        });
    </script>
</body>
</html>
